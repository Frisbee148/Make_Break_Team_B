{"ast":null,"code":"// src/firebase.js\nimport { initializeApp } from \"firebase/app\";\nimport { getAuth, GoogleAuthProvider, signInWithPopup, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut as fbSignOut, onAuthStateChanged } from \"firebase/auth\";\nimport { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, serverTimestamp } from \"firebase/firestore\";\nconst firebaseConfig = {\n  apiKey: \"YOUR_API_KEY\",\n  authDomain: \"YOUR_PROJECT.firebaseapp.com\",\n  projectId: \"YOUR_PROJECT_ID\"\n};\nconst app = initializeApp(firebaseConfig);\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const googleProvider = new GoogleAuthProvider();\n\n// -------------------- AUTH HELPERS --------------------\nexport async function signInWithGoogle() {\n  return signInWithPopup(auth, googleProvider);\n}\nexport async function signInEmail(email, password) {\n  return signInWithEmailAndPassword(auth, email, password);\n}\nexport async function signUpEmail(email, password) {\n  return createUserWithEmailAndPassword(auth, email, password);\n}\nexport async function signOut() {\n  return fbSignOut(auth);\n}\nexport function onAuthChange(cb) {\n  return onAuthStateChanged(auth, cb);\n}\n\n// -------------------- FIRESTORE HELPERS --------------------\n\n// ✅ FIXED: normalize 2D array before saving\nexport async function saveSheet(sheetId, payload) {\n  const normalized = {\n    ...payload,\n    cells: payload.cells ? payload.cells.map(row => Array.isArray(row) ? row.reduce((acc, cell, c) => {\n      acc[c] = cell;\n      return acc;\n    }, {}) : row) : [],\n    updatedAt: serverTimestamp()\n  };\n  await setDoc(doc(db, \"sheets\", sheetId), normalized, {\n    merge: true\n  });\n}\n\n// ✅ FIXED: convert normalized object rows back to arrays when reading\nexport async function getSheetOnce(sheetId) {\n  const d = await getDoc(doc(db, \"sheets\", sheetId));\n  if (!d.exists()) return null;\n  const data = d.data();\n  const cells = (data.cells || []).map(row => typeof row === \"object\" ? Object.values(row) : row);\n  return {\n    ...data,\n    cells\n  };\n}\n\n// ✅ FIXED: apply same conversion for live updates\nexport function subscribeSheet(sheetId, cb) {\n  return onSnapshot(doc(db, \"sheets\", sheetId), snap => {\n    if (snap.exists()) {\n      const data = snap.data();\n      const cells = (data.cells || []).map(row => typeof row === \"object\" ? Object.values(row) : row);\n      cb({\n        ...data,\n        cells\n      });\n    } else cb(null);\n  });\n}\nexport async function updateSheet(sheetId, patch) {\n  await updateDoc(doc(db, \"sheets\", sheetId), {\n    ...patch,\n    updatedAt: serverTimestamp()\n  });\n}","map":{"version":3,"names":["initializeApp","getAuth","GoogleAuthProvider","signInWithPopup","signInWithEmailAndPassword","createUserWithEmailAndPassword","signOut","fbSignOut","onAuthStateChanged","getFirestore","doc","setDoc","getDoc","onSnapshot","updateDoc","serverTimestamp","firebaseConfig","apiKey","authDomain","projectId","app","auth","db","googleProvider","signInWithGoogle","signInEmail","email","password","signUpEmail","onAuthChange","cb","saveSheet","sheetId","payload","normalized","cells","map","row","Array","isArray","reduce","acc","cell","c","updatedAt","merge","getSheetOnce","d","exists","data","Object","values","subscribeSheet","snap","updateSheet","patch"],"sources":["C:/Users/amanm/OneDrive/Desktop/final/src/firebase.js"],"sourcesContent":["// src/firebase.js\nimport { initializeApp } from \"firebase/app\";\nimport {\n  getAuth,\n  GoogleAuthProvider,\n  signInWithPopup,\n  signInWithEmailAndPassword,\n  createUserWithEmailAndPassword,\n  signOut as fbSignOut,\n  onAuthStateChanged,\n} from \"firebase/auth\";\nimport {\n  getFirestore,\n  doc,\n  setDoc,\n  getDoc,\n  onSnapshot,\n  updateDoc,\n  serverTimestamp,\n} from \"firebase/firestore\";\n\nconst firebaseConfig = {\n  apiKey: \"YOUR_API_KEY\",\n  authDomain: \"YOUR_PROJECT.firebaseapp.com\",\n  projectId: \"YOUR_PROJECT_ID\",\n};\n\nconst app = initializeApp(firebaseConfig);\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const googleProvider = new GoogleAuthProvider();\n\n// -------------------- AUTH HELPERS --------------------\nexport async function signInWithGoogle() {\n  return signInWithPopup(auth, googleProvider);\n}\nexport async function signInEmail(email, password) {\n  return signInWithEmailAndPassword(auth, email, password);\n}\nexport async function signUpEmail(email, password) {\n  return createUserWithEmailAndPassword(auth, email, password);\n}\nexport async function signOut() {\n  return fbSignOut(auth);\n}\nexport function onAuthChange(cb) {\n  return onAuthStateChanged(auth, cb);\n}\n\n// -------------------- FIRESTORE HELPERS --------------------\n\n// ✅ FIXED: normalize 2D array before saving\nexport async function saveSheet(sheetId, payload) {\n  const normalized = {\n    ...payload,\n    cells: payload.cells\n      ? payload.cells.map((row) =>\n          Array.isArray(row)\n            ? row.reduce((acc, cell, c) => {\n                acc[c] = cell;\n                return acc;\n              }, {})\n            : row\n        )\n      : [],\n    updatedAt: serverTimestamp(),\n  };\n\n  await setDoc(doc(db, \"sheets\", sheetId), normalized, { merge: true });\n}\n\n// ✅ FIXED: convert normalized object rows back to arrays when reading\nexport async function getSheetOnce(sheetId) {\n  const d = await getDoc(doc(db, \"sheets\", sheetId));\n  if (!d.exists()) return null;\n\n  const data = d.data();\n  const cells = (data.cells || []).map((row) =>\n    typeof row === \"object\" ? Object.values(row) : row\n  );\n  return { ...data, cells };\n}\n\n// ✅ FIXED: apply same conversion for live updates\nexport function subscribeSheet(sheetId, cb) {\n  return onSnapshot(doc(db, \"sheets\", sheetId), (snap) => {\n    if (snap.exists()) {\n      const data = snap.data();\n      const cells = (data.cells || []).map((row) =>\n        typeof row === \"object\" ? Object.values(row) : row\n      );\n      cb({ ...data, cells });\n    } else cb(null);\n  });\n}\n\nexport async function updateSheet(sheetId, patch) {\n  await updateDoc(doc(db, \"sheets\", sheetId), {\n    ...patch,\n    updatedAt: serverTimestamp(),\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}